# 🏗️ Arch Risk Bot MVP: 아키텍처 가드레일 기술 상세 보고서 (Detailed Report)

보검봇(Arch Risk Bot)은 단순한 코드 리뷰 도구가 아닙니다. Python/Django 환경의 **"아키텍처 가드레일"** 시스템으로서, 소프트웨어의 구조적 붕괴(Architecture Decay)를 방지하고 기술 부채의 징후를 조기에 탐지하는 데 목적을 둡니다.

---

## 🏗️ 1. 전체 아키텍처 및 구성 (Architecture)

보검봇은 **모노레포(Monorepo)** 구조로 설계되어 있으며, 크게 두 개의 핵심 레이어로 구성됩니다.

### 📡 A. Webhook 레이어 (`apps/webhook`)
- **기술 스택**: Node.js, Probot, TypeScript, Express
- **역할**: GitHub의 실시간 신호(Webhook)를 수신합니다.
- **주요 기능**:
  - PR 생성(`opened`) 및 업데이트(`synchronize`) 감지.
  - 보안 토큰(JWT) 기반 GitHub App 인증 및 권한 관리.
  - 데이터 필터링(가드레일): 너무 많은 파일(20개 이상)이나 설정 파일 등은 스캔 시 제외하여 효율성 확보.

### ⚙️ B. 분석 엔진 레이어 (`packages/engine`)
- **기술 스택**: TypeScript, Python (py_compile), Gemini AI API
- **역할**: Python/Django 환경에 특화된 코드 분석 및 진단 결과 생성.
- **특화 기능**:
  - **Python Risk Scan**: Python 표준 라이브러리(`os`, `subprocess`, `pickle` 등)의 위험한 사용 패턴을 심층 탐지.
  - **Syntax Check**: `python3 -m py_compile`을 사용하여 구문 오류가 있는지 2차 검증.
  - **AI Diagnosis (Gemini)**: 발견된 리스크에 대해 AI가 문제점 분석 및 리팩토링 코드(Fixed Code) 생성.

---

## 📈 2. 현재 작업 상태 (Current Status)

모든 핵심 기능이 구현되었으며, **End-to-End 검증이 완료**된 상태입니다.

| 구분 | 항목 | 상태 | 비고 |
| :--- | :--- | :--- | :--- |
| **인프라** | Webhook 서버 가동 | ✅ 정상 | Cloudflare Tunnel을 통해 외부 접근 가능 |
| **보안** | 위험 패턴 감지 (Python) | ✅ 정상 | `os.system`, `eval`, `exec` 등 4종 패턴 감지 |
| **연동** | GitHub App 설치 및 인증 | ✅ 정상 | `APP_ID` 및 `PRIVATE_KEY` 정합성 수정 완료 |
| **기능** | PR 자동 댓글 게시 | ✅ 정상 | [PR #5](https://github.com/boy1arthur/arch-risk-bot/pull/5)에서 실시간 댓글 확인 가능 |
| **지능** | Gemini AI 진단 연동 | ⚠️ 제한적 | API 키 연동 완료. (무료 티어 쿼터 초과 시 Mock 데이터로 자동 대체 작동) |

---

## 🔗 3. 작업의 연관성 및 의미 (Relevance)

이번 작업은 보검봇이 **"단순한 AI 리뷰 도구"**가 아니라, **"아키텍처 가드레일"**이라는 새로운 카테고리로 진화하는 결정적인 기반이 되었습니다.

1.  **Codex(코드 지식 체계)와의 결합**:
    - 기존의 봇이 단순히 "코드가 바뀌었어"라고 알리는 수준이었다면, 이제는 **프로그래밍 관행과 보안 위협**을 코드 컨텍스트와 연결하여 분석합니다.
    - 특히 `packages/engine`에 구현된 리스크 스캔 로직은 향후 더 복잡한 아키텍처 패턴(안티 패턴)을 탐지하기 위한 기반(Codex의 코드화)이 됩니다.

2.  **아키텍처 가드레일 확립**:
    - 개발자가 실수로 남길 수 있는 구조적 결함(위험한 시스템 호출, 의존성 불일치 등)을 PR 단계에서 **자동으로 필터링**함으로써, 아키텍처의 안정성을 원천적으로 보장합니다.

3.  **CTO의 의사결정 지원**:
    - AI 진단 엔진(`aiDiagnosis.ts`)이 탑재됨으로써, 단순 에러 보고를 넘어 **"이 구조가 유지될 경우 어떤 아키텍처 리스크가 발생하는가"**에 대한 인사이트를 제공하기 시작했습니다.

---

## 📝 4. 향후 로드맵 (Next Steps)

1.  **AI 모델 및 쿼터 최적화**: Gemini API의 무료 티어 제한을 극복하기 위해 유료 전환 또는 캐싱 로직 강화.
2.  **아키텍처 스캔 규칙 확장**: 보안 위험 외에도 "의존성 위반", "순환 참조" 등 구조적 아키텍처 이슈 탐지 기능 추가.
3.  **클라우드 배포**: 현재 로컬 터널 방식에서 Railway나 Vercel 등 클라우드 환경으로 영구 배포.

---
**보검봇(Arch Risk Bot)**은 이제 단순히 코드를 읽는 것을 넘어, **위험을 판단하고 성장을 돕는 동료**로서 준비가 끝났습니다.
